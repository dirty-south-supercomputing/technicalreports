\chapter{Pok√©mon\label{chap:pokemon}}
The \texttt{PokemonProto} protobuf defines an individual Pok√©mon.
For purposes of battle\footnote{Attributes not directly relevant to battle include height, weight, region,
generation, Shiny status, Purified status, Lucky status, Legendary status, Mythological status, spawn
reason, capture method, capture location, and capture time.}, a Pok√©mon $P$\, is defined as having:
\begin{itemize}
\item A species and form (and thus a typing and base stats)
\item Shadow status, or the absence thereof
\item An Individual Vector (IV) (\autoref{sec:ivs}) and level (\autoref{sec:plevel})
\item A set of two or three attacks, one of which is a fast attack
\item Modifiers due charged attacks' stat effects (\autoref{sec:buffs})
\item Some number of hit points not exceeding \MHP
\item Some amount of energy not exceeding 100
\end{itemize}
Hit Points are carried across PvE battles (including encounters with
  Team GO Rocket and Gym battles), but Trainer Battles always start with full \HP\@.
A Pok√©mon with zero hit points has ``fainted''.
Fainted Pok√©mon cannot be used in battles of any kind, nor can they be left in
 Power Stops (see \autoref{sec:maxbattles}).

Each Pok√©mon has a height and weight, randomly generated according to a Gaussian
 parameterized for each form.
Four or more standard deviations from the mean qualify a Pok√©mon as XXS or XXL,
 each with its own Pok√©dex and associated medal.
Proportional deviation from the mean is maintained across evolution and trade.
Size and height are the criteria for winning Showcases, have no effects otherwise.

\section{Pok√©mon level\label{sec:plevel}}
Each Pok√©mon has its own level, taking one of the 99 integer and half-integer
 values between 0--50, inclusive.
A Trainer can ``power up'' their Pok√©mon in single level increments,
 not exceeding the Trainer's own level plus 10.
Each increase has a cost in Stardust and the Candy of that family; beyond level 40, there
  is a further cost in Candy XL (\autoref{table:powerups}).
\begin{table}
\centering
\begin{tabular}[ht]{rrr|rrrr}
Level &
\includegraphics[width=1em,height=1em]{images/stardust.png} &
\includegraphics[width=1em,height=1em]{images/rarecandy.png} &
Level &
\includegraphics[width=1em,height=1em]{images/stardust.png} &
\includegraphics[width=1em,height=1em]{images/rarecandy.png} &
\includegraphics[width=1em,height=1em]{images/rarecandyxl.png} \\
\Midrule
1.5--3 &   200 & 1 & 31.5--33 &  6,000 &  6 & \\
3.5--5 &   400 & 1 & 33.5--35 &  7,000 &  8 & \\
5.5--7 &   600 & 1 & 35.5--37 &  8,000 & 10 & \\
7.5--9 &   800 & 1 & 37.5--39 &  9,000 & 12 & \\
9.5--11 & 1,000 & 1 & 39.5--40 & 10,000 & 15 & \\
11.5--13 & 1,300 & 2 & 40.5--41 & 10,000 &    & 10 \\
13.5--15 & 1,600 & 2 & 41.5--42 & 11,000 &    & 10 \\
15.5--17 & 1,900 & 2 & 42.5--43 & 11,000 &    & 12 \\
17.5--19 & 2,200 & 2 & 43.5--44 & 12,000 &    & 12 \\
19.5--21 & 2,500 & 2 & 44.5--45 & 12,000 &    & 15 \\
21.5--23 & 3,000 & 3 & 45.5--46 & 13,000 &    & 15 \\
23.5--25 & 3,500 & 3 & 46.5--47 & 13,000 &    & 17 \\
25.5--27 & 4,000 & 3 & 47.5--48 & 14,000 &    & 17 \\
27.5--29 & 4,500 & 4 & 48.5--49 & 14,000 &    & 20 \\
29.5--31 & 5,000 & 4 & 49.5--50 & 15,000 &    & 20 \\
\end{tabular}
\caption{Power-up costs for Pok√©mon levels\label{table:powerups}}
\end{table}
An increase in level improves the Pok√©mon's attack and defense, and
  will sometimes increase \MHP\@.
See \autoref{sec:staticstats} for a quantitative treatment.

Powering up a fainted Pok√©mon will revive it, but with minimal \HP\@:
\[ \HP = \min{1, \MHP_\mathrm{New} - \MHP_\mathrm{Old} } \]
Advancing a normal Pok√©mon from level 1 to level 50 is not a cheap endeavor (\autoref{table:sumcosts}),
  though Shadow Pok√©mon of course have a minimum level of eight, purified Pok√©mon are always
  at least level 25, and most captures will be well above level 1.
Note that pushing level 40 to 50 requires more Stardust than going from 1 to 40.
\begin{table}[ht]
\centering
\begin{tabular}{lrrr}
  Type & Candy & Candy XL & Stardust\\
\Midrule
        Normal & 304 & 296 & 520,000\\
        Shadow & 406 & 360 & 624,000\\
      Purified & 294 & 272 & 468,000\\
         Lucky & 304 & 296 & 260,000\\
Lucky purified & 294 & 272 & 234,000\\
\end{tabular}
\caption{Total costs for powering up from level 1 to 50\label{table:sumcosts}}
\end{table}

\section{Individual vectors\label{sec:ivs}}
Each Pok√©mon has three associated integers, each ranging from 0--15.
Once a Trainer has joined a team (\autoref{sec:levels}), the ``Appraise'' function can be used to
  get a visual representation of these three numbers (this representation,
  while annoying, is sufficient to determine the actual numbers).
Additionally, the Pok√©mon will be given a rating of 0--4 (\autoref{table:appraisal}), represented as
  zero, one, two, or three stars (4 shows three, albeit in a different color).
A Pok√©mon rated 4 has an IV of 15/15/15, and is colloquially known as a ``hundo'' or ``100\%er''.
Such Pok√©mon have their own Pok√©dex (\autoref{sec:dexen})\footnote{A Pok√©mon with an IV of 0/0/0
 is colloquially known as a ``nundo'' or ``0\%er''. They have no unique Pok√©dex, because they are worthless pieces of shit,
  and don't let anyone tell you otherwise. Consult \autoref{chap:optimal} to see that 0/0/0 is never an optimal IV.}.
While 15/15/15 is generally the optimal IV, this is not always true in \CP-bounded
  competition; see \autoref{chap:bounded} for more information,
  and \autoref{chap:optimal} for tables of optimal IVs under different \CP{} bounds.
\begin{table}
\centering
\begin{tabular}{ll}
Appraisal & Minimum sum of IVs\\
\Midrule
4üüâ & 45\\
3üüâ & 37\\
2üüâ & 30\\
1üüâ & 23\\
0üüâ & 0\\
\end{tabular}
\caption{Appraisals for various IVs\label{table:appraisal}}
\end{table}

Three things can change a Pok√©mon's IV, which is otherwise constant across its existence.
Purification (\autoref{sec:shadow}) raises each component by two, not to exceed fifteen.
Trades (\autoref{sec:trades}) reroll the IV entirely.
Finally, Silver and Gold Bottle Caps allow a Pok√©mon of at least Best Buddy status (\autoref{sec:buddies})
  to enter ``hypertraining''.
Silver Caps allow one IV component to be increased; Golden Caps can increase all three components.
The Trainer specifies a new, higher IV, and is assigned a set of Research-like tasks.
If they are completed within the specified time, the Pok√©mon acquires the new IV.
Bottle Caps cannot be used on Shadow Pok√©mon.
At the time of this writing, Bottle Caps have been available only through paid Research.

\section{Generation of IV and level\label{sec:ivgeneration}}
IVs and levels are generated when the Pok√©mon is ``created'', not when it is captured.
It is thus possible to glean information from the \CP{} displayed for a Pok√©mon;
  one can sometimes even uniquely determine the IV\@.
The equation for \CP{} is provided in \autoref{chap:unbounded}; reverse it and
  use \autoref{table:cpm} plus the base stats of the species to determine
  the set of IV+level pairs yielding that \CP\@.
Various applications and websites can perform this analysis automatically.
Depending on the situation, there might be a floor for IVs.
Beyond that, they are uniformly randomly generated.
The chance of any given IV for a catch in the wild (without weather boosting)
  is exactly the same---1 out of 4096.
The probability of a random Pok√©mon being a hundo is actually
  greater than that of being a nundo, due to the existence of IV floors
  (e.g.\ the chance of a 15/15/15 for a lucky trade is 1 in 256, whereas
  a 0/0/0 is impossible).
\begin{table}
\centering
\begin{tabular}{lcc}
Context & IV floors & Level \\
\Midrule
\rowcolor{Gray!25}
& 0 & 1--max(TL, 30) \\
\rowcolor{Gray!25}
\multirow{-2}{*}{Wild catch} & 4 w/ weather boost & 1--max(TL, 30) + 5 \\
Hatch & 10 & max(TL, 20) \\
\rowcolor{Gray!25}
& 6 (shadow) & 25 w/ weather boost \\
\rowcolor{Gray!25}
\multirow{-2}{*}{Raid} & 10 & 20 \\
Max Battle & 10 & 20 \\
\rowcolor{Gray!25}
Research & 10 & 15 \\
Team GO Rocket & 0 & 8 \\
Grunts and Leaders & 4 w/ weather boost & 13 w/ weather boost \\
\rowcolor{Gray!25}
& & 8\\
\rowcolor{Gray!25}
\multirow{-2}{*}{Giovanni} & \multirow{-2}{*}{6} & 13 w/ weather boost\\
GBL & 10 & 20\\
\rowcolor{Gray!25}
& 1 w/ Good Friend &\\
\rowcolor{Gray!25}
& 2 w/ Great Friend & \\
\rowcolor{Gray!25}
\multirow{-2.5}{*}{Trade} & 3 w/ Ultra Friend & \multirow{-2.5}{*}{See \autoref{sec:trades}}  \\
\rowcolor{Gray!25}
& 5 w/ Best Friend & \\
\rowcolor{Gray!25}
& 12 (lucky trade) & \\
Mighty Pok√©mon & 13 & 35--40 \\
\end{tabular}
\caption{IV and level floors for acquired Pok√©mon\label{table:ivfloors}}
\end{table}

\section{Lucky Pok√©mon\label{sec:lucky}}
Trades sometimes result in both Pok√©mon becoming ``Lucky''.
Lucky Pok√©mon have an IV floor of 12/12/12, and enjoy a 50\% discount on Stardust for power-ups
  (this does not extend to learning second charged attacks).
This discount stacks with the 10\% purification discount, so costs for
  powering up Lucky Purified Pok√©mon run 45\% of normal.

\section{Static stats\label{sec:staticstats}}
We'll define some statistics for each Pok√©mon.
These values are used as inputs to battle mechanics.
First, sum the Species's ATK, DEF, and STA with the Pok√©mon's
IVs to generate \Mod{A}, \Mod{D}, and \Mod{S}:
\begin{align*}
 \Mod{A} &= \mathrm{ATK} + \mathit{\IV{A}} \\
 \Mod{D} &= \mathrm{DEF} + \mathit{\IV{D}} \\
 \Mod{S} &= \mathrm{STA} + \mathit{\IV{S}}
\end{align*}
These are typically scaled by the Pok√©mon's Combat Power Multiplier.
\section{Combat Power Multiplier\label{sec:cpm}}
Recall that each Pok√©mon has its own level, ranging from 1.0
 to 50.0, defined on half integers\footnote{I would rather they
 simply be integer Levels 1--99, but this is settled terminology.}.
This level is used as an index into a table of positive rational constants.
The value accessed is that Pok√©mon's Combat Power Multiplier (\CPM).
\CPM{} maxes out at level 50 with a value of 0.8403, and takes its 0.094 minimum at level 1.
At level 10, \CPM{} is 0.4225, almost half of its maximum value.
At level 34, \CPM{} is 0.7557, about 90\% of its maximum value.
The extremal ratios are 0.1119 (L1 / L50) and 8.9394 (L50 / L1).
The \CPM{}s of integer levels are defined in the game master file; half-integer levels
 are synthesized on the fly by interpolating between the two surrounding levels.

That's the theory.
In truth, no such level is present in the definition of a Pok√©mon.
It can be synthesized from two real fields: \texttt{cpMultiplier} and \texttt{additionalCpMultiplier}.
The first is constant across the Pok√©mon's existence, and is the \CPM{} of the Pok√©mon when captured.
It is always a value from the game master array; this implies that Pok√©mon can only be caught on integer levels,
 which is borne out by observation.
To get the actual \CPM{} used in calculations, \texttt{cpMultiplier} is added to \texttt{additionalCpMultiplier}; the
 latter changes each time the Pok√©mon is powered up.
This sum would ideally map cleanly to ninety-nine floating point values.
Unfortunately, the details of floating point math mean two pairs of ``levels'' $A$ and $B$
 and $C$ and $D$ might not yield precisely the same sum, even though $A+B = C+D$.
There is thus no true \CPM{} table; \autoref{table:cpm} is a lie; somewhere in
 California, William Kahan is screaming.
Accurately simulating the Pok√©mon GO CP calculation requires fifty tables, one for each possible capture level.
This imprecision shows up only infrequently, and the naive CP calculation is never more than one point off.
\input{out/cpms}
\section{Effective stats\label{sec:effectivestats}}
Multiplying \Mod{S} by \CPM{} yields \Eff{S}, which determines a Pok√©mon's Maximum Hit Points (\MHP).
When a Pok√©mon's Hit Points are reduced to 0, it is knocked out, and cannot be
 used (nor made a Buddy) until revived.
Hit Points are persistent across Raids, Max Battles, and Team Rocket encounters,
 and can be restored (up to \MHP) with Potions\footnote{Trainer Battles (other
 than those with Team Rocket) always start with full HP.}.
\MHP is defined such that it is always an integer not less than ten:
\begin{align*}
  \Eff{S} &= \Mod{S} \cdot \CPM{} \\
  \MHP{} &= \max{10, \lfloor \Eff{S} \rfloor}
\end{align*}
Multiplying \Mod{S} by \CPM{} yields \Eff{ARaw}, used to determine charged move priority (\autoref{sec:3x3}).
$M_{Shadow}$ is $\frac{6}{5}$ if the Pok√©mon is a Shadow Pok√©mon, and 1 otherwise.
Multiplying \Eff{ARaw} by $M_{Shadow}$ yields \Eff{A}.
Multiplying \Mod{D} by CPM and dividing by $M_{Shadow}$ gives us \Eff{D}.
This manifests a 20\% bonus to \Eff{A} and a 16.7\% penalty to \Eff{D}.
\begin{align*}
  \Eff{ARaw} &= \Mod{A} \cdot \CPM{}\\
  \Eff{A} &= \Eff{ARaw} \cdot M_{Shadow} \\
  \Eff{D} &= \frac{\Mod{D} \cdot \CPM{}}{M_{Shadow}}
\end{align*}
Is a Shadow Pok√©mon superior to its unshadowed equivalent, all else being equal?
Evaluating using a product function such as the geometric mean will show no difference;
 the two multipliers cancel one another.
\begin{align*}
  P &= \Eff{A} \cdot \Eff{D}\\
  &= \frac{6\Mod{A}}{5} \cdot \frac{5\Mod{D}}{6} \cdot \CPM{}^2
\end{align*}
Using a sum function such as the arithmetic mean will usually show a difference:
\begin{align*}
  \Mod{A} &< \frac{5\Mod{D}}{6}\text{: the average goes down}\\
  \Mod{A} &= \frac{5\Mod{D}}{6}\text{: the average is unchanged}\\
  \Mod{A} &> \frac{5\Mod{D}}{6}\text{: the average goes up}
\end{align*}

Let's compare the impact of levels and IVs on effective stats.
A Pok√©mon has base ATK and DEF $A$ and $D$, and level $L$ with corresponding \CPM{} $C_0$.
Raising \IV{A} by one raises \Eff{A} by $C$.
Raising \IV{D} by one raises \Eff{D} by $C$.
Raising \IV{S} by one raises \Eff{S} by $C$, raising MHP by either zero or one.
Raising $L$ by 0.5 results in a new \CPM{} $C_{0.5}$; define $C_Œî = C_{0.5} - C_0$.
At its maximum, $C_Œî$ is 0.0411; it is 0.0025 from level 40 on.
Leveling up thus raises \Eff{A} by $\Mod{A} \cdot C_Œî$,
 \Eff{D} by $\Mod{D} \cdot C_Œî$,
 and \Eff{S} by $\Mod{S} \cdot C_Œî$.
Note that $C_Œî$ becomes smaller as $C$ becomes larger,
 and the impact of leveling increases as the base stat increases.
For typical base stats, leveling up improves the effective stat more through
 about level 30, at which point IVs have more impact.
A base stat of 100 is improved more by \IV{} at level 25.5.

\section{Searching Pok√©mon storage\label{sec:searching}}
When browsing storage, a blue hue around a Pok√©mon indicates capture within the past twenty-four hours.
The search interface for Pok√©dexen and storage is surprisingly capable.
Most strings are matched as substrings in both nicknames and species names,
 but there are a number of keywords (\autoref{table:searchterms}).
Most are self-evident.
Prefix a species with \texttt{+} to search for its family.
Searching for a type will show any Pok√©mon with that type in their typing,
 \texttt{<type} matches Pok√©mon weak against \texttt{type},
 and \texttt{>type} those strong against it.
\texttt{x*} for \texttt{x} between 0 and 4 matches Pok√©mon with that appraisal.
\texttt{buddy0} matches Pok√©mon which have never been your Buddy,
 \texttt{buddy1} those made your Buddy but having earned zero hearts,
 and \texttt{buddyx} for \texttt{x} between 2 and 5 to match buddy
 levels \texttt{x} - 1.
\texttt{favorite} matches those marked ``favorite'' using a star system that
 seems like it could have handled in the general tagging system just fine
 but whatever.
Speaking of, \texttt{\#TAG} searches the tag space, and \texttt{\#} by itself
 matches anything tagged.
\texttt{@weather} shows Pok√©mon with at least one attack boosted by current
 weather, \texttt{@ATTACK} shows Pok√©mon who know \texttt{ATTACK}, and \texttt{@TYPE}
 any who know some attack of type \texttt{TYPE}.
Be more specific with \texttt{@xTYPE} for \texttt{x} between 1 and 3 to check
  for a fast, first charged, or second charged attack of the specified type.
Range suffixes take the form \texttt{NUM} for an exact match of \texttt{NUM},
  \texttt{NUMX-NUMY} for an inclusive match between \texttt{NUMX} and \texttt{NUMY},
  and \texttt{-NUM} for an inclusive ceiling.
\texttt{cpRANGE} and \texttt{hpRANGE} match Combat Power and hit points.
Use \texttt{distanceRANGE} and \texttt{ageRANGE} to match catch location
  distance in kilometers and catch age in days.
\texttt{yearRANGE} matches the catch year.
Union over searches is accomplished with the infix ';' operator (',' and ':' are synonyms),
  and intersection with '\&'\footnote{Oddly, '|' also seems to function as AND. I say ``oddly'' because it means OR everywhere else.
  Except the UNIX shell, where it means ``pipe''.
  And set theory (intensional comprehensions).
  And number theory (``divides'').
  And the bra-ket notation of quantum mechanics.
  OK, not everywhere, but that doesn't mean you use it for intersection.}.
It does not seem possible to search for regional forms using substrings,
 e.g.\ a search for ``alolan'' does not bring up my Alolan Exeggutor,
 but each region is itself a search keyword.
Language settings can change certain keywords.
\begin{tipbox}[title=Some useful search strings]
\footnotesize
\raggedright
Not tagged: \textit{\texttt{!\#}}

Two charged attacks: \textit{\texttt{!@3move}}

Can be evolved into new dex entries: \textit{\texttt{evolvenew\&evolve}}

Can become a hundo via a silver bottle cap:

\textit{\texttt{4attack,4defense\&4attack,4hp\&4defense,4hp\&!4*\&!shadow}}
\end{tipbox}
Tagging and nicknaming are powerful techniques to organize your Pok√©mon.
Some Trainers encode IVs into nicknames directly using Unicode's ``Enclosed Alphanumerics'' block,
 particularly \texttt{U+24EB}--\texttt{U+24FF}.
I personally nickname everything with a suffix indicating that Pok√©mon's distance from the ideal IV for its relevant League.
If the IV is ideal, the distance is zero; the largest possible difference is 45.
It's rare that I want to keep a Pok√©mon with a difference that requires two numbers,
 so this is usually a single character.
If the Pok√©mon is a Shadow, I add an `S' to the prefix; if it has a legacy move, I add an 'L'.
These are just quick visual indicators.
For searching, I use the more powerful tags.
Each Pok√©mon is sorted into one of the three Leagues with a ``greatleague'', ``ultraleague'',
 or ``masterleague'' tag, or ``totrade'' if it's only being kept for trade.
If I have no such use for a Pok√©mon, it's dispatched to the Professor (the only exceptions are Pok√©mon being kept for some necessary evolution).
Unless I've powered the Pok√©mon up to the maximum level viable in its target League, it
 gets a ``powerup'' tag.
Unless it's completed the desired evolutionary journey, it gets ``evolve''.
Until it has a second attack, it gets ``needs2nd''; if it lacks a desirable legacy attack, it gets `needslegacy''.
Other than the League tag, these tags are all removed upon being satisfied.
Pok√©mon with an optimal IV for their League are tagged ``optimal'' (and have a ``0'' suffix, as described above).
Ideally, only new Pok√©mon are untagged (when ``evolve'' is removed from a Pok√©mon due to
 evolution, it can become untagged, but this indicates it ought be transfered).

I never have more than twelve of any given form, unless I'm keeping some for trade.
This maximum requires both Shadow and normal forms suitable for each of three Leagues,
 and ``farm system'' (i.e.\ not fully developed) Pok√©mon corresponding to each of these six.
At some point, each Pok√©mon in development will replace some existing Pok√©mon, and the
 latter will be transferred.
In reality, it's extremely rare for me to carry four or more of a single form.
Theoretically, I could want multiple Master League-class copies of a single form for
 use in Raids, but I get by just fine.
Yes, this means I transfer hundos, a practice many would consider repugnant.
Indeed, I don't just transfer duplicate hundos, but also those for which I see no purpose.
I am limited to 600 Pok√©mon (the lowest limit I've seen from any competitive player),
 yet have never found myself wishing I had thousands to draw from.
\begin{table}
\centering\small
\begin{tabular}{ll}
Keyword & Matches \\
\Midrule
\texttt{background} & Special background \\
\texttt{candyxl} & Level 40 and above \\
\texttt{costume} & Costumed event form \\
\texttt{defender} & In a gym \\
\texttt{dynamax} & Can Dynamax\\
\texttt{eggsonly} & Baby Pok√©mon \\
\texttt{evolve} & Can evolve now\\
\texttt{evolvenew} & Evolution will fill a Pok√©dex entry\\
\texttt{female} & Females \\
\texttt{gbl} & Acquired via GO Battle League rewards\\
\texttt{genderunknown} & Ungendered \\
\texttt{gigantamax} & Can Gigantamax\\
\texttt{hatched} & Obtained from egg \\
\texttt{item} & Evolution requires an item (\autoref{table:itemevolutions})\\
\texttt{legendary} & Legendary \\
\texttt{lucky} & Lucky Pok√©mon \\
\texttt{male} & Males\\
\texttt{megaevolve} & Can Mega or Primal evolve\\
\texttt{megaraid} & Caught in Mega raid\\
\texttt{mythical} & Mythical\\
\texttt{primalraid} & Caught in Primal raid\\
\texttt{purified} & Purified Pok√©mon\\
\texttt{raid} & Caught in any kind of raid\\
\texttt{remoteraid} & Caught in remote raid\\
\texttt{research} & Obtained in research\\
\texttt{rocket} & Rescued from Team GO Rocket\\
\texttt{shadow} & Unpurified Shadow Pok√©mon (\autoref{sec:shadow})\\
\texttt{shiny} & Shiny Pok√©mon\\
\texttt{special} & Exclusive move(s) (\autoref{sec:tms})\\
\texttt{tradeevolve} & Evolution discount if traded (\autoref{table:tradeevolution})\\
\texttt{traded} & Acquired via trade\\
\texttt{ultrabeasts} & Ultra Beasts (\autoref{sec:regions})\\
\texttt{xl/xs} & Extra large / extra small\\
\texttt{xxl/xxs} & Extra extra large / extra extra small\\
\end{tabular}
\caption{Search terms for Pok√©mon storage/Pok√©dex\label{table:searchterms}}
\end{table}
